# Complex substitution models 

Sequence data that have evolved under heterotachy - i.e. rate variation across sites and lineages - are known to mislead phylogenetic inference. Complex substitution models are essential for accurately modeling this evolutionary process.

--- 

### mixture models

Both partition and mixture models allow more than one substitution model along the sequences ... but what is the difference?!

- a partition model assigns each alignment site a given specific model

- a mixture model will compute  each site probability (or weight) of belonging to each mixture class (also categories or components)

 Mixture models account for heterogeneity in the evolutionary process across sites in a sequence alignment.

To start, use the following command:

```iqtree -s data/example_alignements/nt/Rhabdomeric1.nt.aln -m "MIX{JC,GTR}+G4" -wspmr --prefix mixture```

Here, we specfied  a mixture model _via_ the ```MIX``` keyword in the model string ```-m "MIX{JC,GTR}+G4"```. The components - a ```JC``` model, and a ```GTR``` model - are given in curly brackets and separated with a comma. Furthermore, other than the two mixture components we specify four Gamma rate categories using ```+G4```. Overall there are eight mixture components. 

IQ-TREE will then estimate the parameters of each mixture components as well as their weights: the proportion of sites belonging to each component. The flag ```-wspmr``` can be used to write site posterior probabilities per mixture class and rate category to a ```.siteprob``` file. Take a look at it using ```head mixture.siteprob```.

---

As for traditional model selection, also when using mixture models we need to find some objective criteria. MixtureFinder is an approach to select the optimum number of classes and the substitution model in each class for a mixture model of Q matrices. 

```iqtree -s data/example_alignements/nt/Rhabdomeric1.nt.aln -m MIX+MFP -mset JC,GTR -mrate E,I,G,I+G -qmax 5 --prefix mixture```

Here 

BIC is the default criterion to assess the number of classes in the Q mixture model. 

-m MIX+MFP
-mset 
-mratwe
-qmax	Maximum number of Q-mixture classes (default: 10). Specify a number after the option (e.g., -qmax 5).

---

# heterotachy models

A cool model to adressed heterotachy is the General Heterogeneous evolution On a Single Topology (GHOST) model ([Crotty et al. 2020](https://academic.oup.com/sysbio/article-abstract/69/2/249/5541793?redirectedFrom=fulltext)). 

GHOST is an edge-unlinked mixture model consisting of several site classes, each having a separate set of model parameters and edge lengths on the same tree topology. In contrast to an edge-unlinked partition model, the GHOST model does not require the a priori data partitioning, a possible source of model misspecification.

The GHOST model with k mixture classes is executed by adding ```+H``` to the flag ```-m```. For example if one wants to fit a GHOST model with 4 classes in conjunction with the GTR one would use the following command:

```iqtree -s data/example_alignements/nt/Rhabdomeric1.nt.aln -m GTR+H4 --prefix GHOST```

By default the above command will link GTR parameters across all classes. If you want to unlink GTR parameters, so that IQ-TREE estimates them separately for each class, replace +H4 by *H4:

```iqtree -s data/example_alignements/nt/Rhabdomeric1.nt.aln -m GTR*H4 --prefix GHOST```

Note that this infers one set of empirical base frequencies and apply those to all classes. If one wishes to infer separate base frequencies for each class then the +FO option is required:

```iqtree -s data/example_alignements/nt/Rhabdomeric1.nt.aln -m GTR+FO*H4 --prefix GHOST```

Again, the ```-wspmr``` option will generate a ```.siteprob``` output file. 

---

### [main](https://github.com/for-giobbe/MP25/tree/main)