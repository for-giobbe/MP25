## Estimate divergence time in a Maximum Likelihood framework

Maximum Likelihood is a good alternative to the computational burden of Bayesian Inference in the era of phylogenomics and, as almost everything, we can carry on this analyses again with IQ-TREE! It implements the least square dating (LSD2) method to build a time tree when you have date information for tips or ancestral nodes. See ([here](https://academic.oup.com/sysbio/article/65/1/82/2461506) the link for the original paper).

- **Tip dating** is commonly used in two different scenarios:
  - when analyzing viruses
  - when your have a tree encompassing extant and extinct taxa.

- **Nodes dating** is used when you want toimplement informations from:
  - fossils specimens
  - biogeografical events

---

### Nodes dating

As you may remember we allready inferrred a small Mollusck phylogeny. How can we chose which nodes to calibrates and how to calibrate them? A straightforward way is to just to use the divergence times allready inferred for certain nodes in the litterature. Here we will take [Kocot et al. 2020](https://www.nature.com/articles/s41598-019-56728-w) as a reference. Let'shave a look at some of their divergence time estimations:

| Node                              | Divergence time (Mya)    | 95% HPD (Mya)     |
| ----------------------------------|:------------------------:| -----------------:|
| Mollusca                          | 545.449                  | 540.386 - 552.405 |
| Bivalvia + Gastropoda + Scaphopoda| 529.765                  | 525.529 - 534.738 |
| Gastropoda                        | 424.426                  | 408.354 - 439.456 |

Where:
  * **95% HPD** = Confidence interval of the estimation
  * **Ganglionata** = Gastropoda + Scaphopoda + Cephalopoda + Bivalvia
  * **Node** = Start of divergence of the relative clade (crown)

So now let's start our dating. First of all, we have to compile a txt files with informations about nodes that we want to constrain (called date file). It should be something like this:

```
taxon3,taxon4 -100
taxon1,taxon2 -50
taxon6 -10
```

which, for example, mean that the most recent common ancestor (MRCA) of taxon1 and taxon2 existed 50 mya (million year ago) and the MRCA of taxon3 and taxon4 existed 100 mya. Note that **no empty space** should be added to the comma-separated list of taxa, as empty space is used as a separator between taxon list and dates.

After that we need to run IQ-TREE specifing our precomputed ML tree, the partitioning scheme and the [date file](https://github.com/for-giobbe/phy/blob/master/2021/Data/Ready_to_Use_My_Calibrations.txt). Moreover, when dealing with divergence time estimations, it's always better to also specify the outgroup. Indeed time trees, contrary to ML trees, are rooted by definition!

```bash
iqtree -s Analyses/IQ-TREE/My_Concat.fa --date Data/My_Calibrations.txt -spp Analyses/IQ-TREE/spp_MergedPartitions.best_scheme.nex --date-tip 0 -o "H_robusta" -te Analyses/IQ-TREE/specie.tree.treefile --prefix Analyses/IQ-TREE/Time_Tree/My_DivergenceTime --date-options "-u 1"
```

- which will resample branch lengths 100 times to infer the confidence intervals. Note that this is not bootstrap and the method is much faster but unpublished. 

Results files are almost the same as describe before, beside the presence of a ```timetree.nexus``` file. The nexus format is commonly used in divergence time estimation and Bayesian inference since it is able to store much more information than newick (*e.g* confidence intervals, more variables ...).

Now open the nexus file with figtree and take a look at the tree (remember to display also the node ages)...

..As you can see there is a very short branch between *A.granulata* and other Mollusks. This may be due to 3 variables: (1) **Low taxon sampling**; (2) **Wrong topology** and (3) a true **fast radiation** of Mollusks at the begginning of the Cambrian era. 

---

### Tips dating



---

### [main](https://github.com/for-giobbe/MP25/tree/main)